<!doctype html><html lang=en><head><title>Jumping Ship: Migrating your container images from DockerHub to Quay.io ::
CC's Sink — A spot for my thoughts, ramblings, and occasionally advice</title><meta charset=utf-8><meta name=viewport content="width=device-width,initial-scale=1"><meta name=description content="Here are the steps I took to move my images from DockerHub to Quay. If you&amp;rsquo;re not interested in my thoughts or background, or know what you&amp;rsquo;re doing, scroll down to &amp;ldquo;Moving the Images&amp;rdquo;.
Background I host several repositories at DockerHub, both for work and personally. When DockerHub announced they would be deleting container images not used within 6 months, I understood. They provide a great service to the community, and frankly I&amp;rsquo;m surprised this didn&amp;rsquo;t happen sooner."><meta name=keywords content><meta name=robots content="noodp"><link rel=canonical href=/posts/2020-jumping-ship-dockerhub-quay/><link rel=stylesheet href=/assets/style.css><link rel=stylesheet href=/style.css><link rel=apple-touch-icon-precomposed sizes=144x144 href=/img/apple-touch-icon-144-precomposed.png><link rel="shortcut icon" href=/img/favicon.png><link href=/assets/fonts/Inter-Italic.woff2 rel=preload type=font/woff2 as=font crossorigin><link href=/assets/fonts/Inter-Regular.woff2 rel=preload type=font/woff2 as=font crossorigin><link href=/assets/fonts/Inter-Medium.woff2 rel=preload type=font/woff2 as=font crossorigin><link href=/assets/fonts/Inter-MediumItalic.woff2 rel=preload type=font/woff2 as=font crossorigin><link href=/assets/fonts/Inter-Bold.woff2 rel=preload type=font/woff2 as=font crossorigin><link href=/assets/fonts/Inter-BoldItalic.woff2 rel=preload type=font/woff2 as=font crossorigin><meta name=twitter:card content="summary"><meta name=twitter:title content="Jumping Ship: Migrating your container images from DockerHub to Quay.io"><meta name=twitter:description content="Here are the steps I took to move my images from DockerHub to Quay. If you&rsquo;re not interested in my thoughts or background, or know what you&rsquo;re doing, scroll down to &ldquo;Moving the Images&rdquo;.
Background I host several repositories at DockerHub, both for work and personally. When DockerHub announced they would be deleting container images not used within 6 months, I understood. They provide a great service to the community, and frankly I&rsquo;m surprised this didn&rsquo;t happen sooner."><meta property="og:title" content="Jumping Ship: Migrating your container images from DockerHub to Quay.io"><meta property="og:description" content="Here are the steps I took to move my images from DockerHub to Quay. If you&rsquo;re not interested in my thoughts or background, or know what you&rsquo;re doing, scroll down to &ldquo;Moving the Images&rdquo;.
Background I host several repositories at DockerHub, both for work and personally. When DockerHub announced they would be deleting container images not used within 6 months, I understood. They provide a great service to the community, and frankly I&rsquo;m surprised this didn&rsquo;t happen sooner."><meta property="og:type" content="article"><meta property="og:url" content="/posts/2020-jumping-ship-dockerhub-quay/"><meta property="article:published_time" content="2020-09-14T18:31:03+02:00"><meta property="article:modified_time" content="2020-09-14T18:31:03+02:00"><meta property="og:site_name" content="CC's Sink"></head><body class=dark-theme><div class=container><header class=header><span class=header__inner><a href=/ class=logo style=text-decoration:none><span class=logo__mark><svg xmlns="http://www.w3.org/2000/svg" class="greater-icon" viewBox="0 0 44 44"><path fill="none" d="M15 8l14.729 14.382L15 35.367"/></svg></span><span class=logo__text>CC's Sink</span>
<span class=logo__cursor></span></a><span class=header__right><nav class=menu><ul class="menu__inner menu__inner--desktop"><li><a href=/about>About</a></li><li><a href=/showcase>Showcase</a></li></ul><ul class="menu__inner menu__inner--mobile"><li><a href=/about>About</a></li><li><a href=/showcase>Showcase</a></li></ul></nav><span class=menu-trigger><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M0 0h24v24H0z" fill="none"/><path d="M3 18h18v-2H3v2zm0-5h18v-2H3v2zm0-7v2h18V6H3z"/></svg></span><span class=theme-toggle><svg class="theme-toggler" width="24" height="24" viewBox="0 0 48 48" fill="none" xmlns="http://www.w3.org/2000/svg"><path d="M22 41C32.4934 41 41 32.4934 41 22 41 11.5066 32.4934 3 22 3 11.5066 3 3 11.5066 3 22s8.5066 19 19 19zM7 22C7 13.7157 13.7157 7 22 7V37C13.7157 37 7 30.2843 7 22z"/></svg></span></span></span></header><div class=content><div class=post><h1 class=post-title>Jumping Ship: Migrating your container images from DockerHub to Quay.io</h1><div class=post-meta><span class=post-date>2020-09-14</span>
<span class=post-read-time>— 5 min read</span></div><div class=post-content><p>Here are the steps I took to move my images from DockerHub to Quay. If you&rsquo;re not interested in my thoughts or background, or know what you&rsquo;re doing, scroll down to &ldquo;Moving the Images&rdquo;.</p><h2 id=background>Background</h2><p>I host several repositories at DockerHub, both for work and personally.
When DockerHub announced they would be <a href=https://www.docker.com/pricing/resource-consumption-updates>deleting container images</a> not used within 6 months, I understood.
They provide a great service to the community, and frankly I&rsquo;m surprised this didn&rsquo;t happen sooner. Docker Inc., and it&rsquo;s (new-ish) owner Mirantis, don&rsquo;t have the cash to burn like the Google and Amazon do.
Still though, it&rsquo;s a bit sad, and can be frusterating. I believe DockerHub suffers from the same issue that <a href=https://stackoverflow.com/q/13321556/1709894>GitHub / Git</a> does. For people not in-the-know, they are synonyms. This is perpetuated by the fact that the default docker registry for everyone using the Docker container implementation, is docker.io.</p><p>If you weren&rsquo;t aware, whether you&rsquo;re new or never looked into the matter much, the command <code>docker pull herocc/my-cool-image:latest</code> actually maps to <code>docker pull docker.io/herocc/my-cool-image:latest</code>. See the difference there?
The default container registry for <code>docker</code>, is DockerHub. They look similar, but aren&rsquo;t the same.</p><p>Nonetheless, docker (the container engine) and DockerHub (the container registry) aren&rsquo;t the same. And now, lots of images (<em>4.5PB worth!!</em>) are slated for deletion. You have two options: pony up for a premium <a href=https://www.docker.com/pricing>DockerHub subscription</a> for you or your company, or if you <em>really</em> need those oft-unused images to still be publicly avaliable with a $0 budget, you can move to a another registry, such as quay.io.</p><p><a href=https://quay.io>Quay.io</a> is another container registry, which as of this writing, offers a free public repo with unlimited retention. It is run by RedHat (and it&rsquo;s parent company, IBM), which has been making huge investments into containerization tech. I trust it will stick around for a while, and has a lot of nice features compared to DockerHub which I wasn&rsquo;t aware of before (though that&rsquo;s a point for another article).</p><p>Anyway, on to the part you actually cared about: migrating the images.</p><h2 id=getting-ready>Getting Ready</h2><p>You&rsquo;re going to need an account on Quay to be able to push new images. Navigate to <a href=https://quay.io/repository/>quay</a> and sign in or make an account. Then, click the &ldquo;Create new repository&rdquo; button. Fill this in as you like. For mine, I selected &ldquo;Public&rdquo;, and &ldquo;(Empty repository)&rdquo;. You can look into using Quay for your builds if you&rsquo;d like, but that&rsquo;s out of scope for this post.</p><p>Once you have your repo, you&rsquo;re going to need to sign in to quay locally to get permission to push image tags. Technically you can <code>docker login quay.io</code> with the username and password you just used, but for better security, you should follow these next steps. Click your username in the top right corner, click &ldquo;Account Settings&rdquo;, and &ldquo;Generate Encrypted Password&rdquo;. Once you get through the prompts, you&rsquo;ll find yourself with a long string of text. You can now run <code>docker login quay.io</code>, providing your standard username, and the encrypted password.</p><p>You should see something along the lines of &ldquo;Successful Login&rdquo;, and once you do, you&rsquo;re ready for the next step.</p><h2 id=moving-the-images>Moving the Images</h2><p>One way of moving the images is to pull them each down to your computer, <code>docker tag my-old/repo:tag quay.io/my-new/repo:tag</code>, but that is slow and inefficient. You need to manually pull each tag from the old registry, re-tag it, and push it back up again. If you have a lot of images, this could take a long time. Fortunately, there&rsquo;s an alternative: Skopeo.</p><p>Skopeo is a &ldquo;command line utility that performs various operations on container images and image repositories&rdquo;. One of the features it provides is copying images from one registry to another &ndash; either one-off, or syncing entire repos and registries. We will be using their <code>skopeo sync</code> feature to move over all of our tags.</p><p>First, lets install skopeo. This depends on your operating system, so you should read <a href=https://github.com/containers/skopeo/blob/master/install.md>their installation instructions</a> and come back once you&rsquo;ve finished.</p><p>Once you finished installing skopeo, you should see something like this:</p><pre><code>$ skopeo --version
skopeo version 1.1.1
</code></pre><p>If you do, that means you&rsquo;re ready to go! Make sure you&rsquo;re logged in to quay by running <code>skopeo login quay.io</code>, and you&rsquo;re ready to construct your command.</p><p>If your old image repo is hosted on DockerHub, it&rsquo;s full link is <code>docker.io/YOUR-ORG-OR-NAME/REPO-NAME</code>. Your repo on quay, the one you just made, is likely similar, <code>quay.io/YOUR-ORG-OR-NAME/REPO-NAME</code>. All you have to do is tell skopeo to sync one to the other.</p><p>If you have a lot of images this may take a while, so consider starting a <code>screen</code> session (something like <code>screen -S quaysync</code>). Then, replace the links below with your repo, and hit enter:</p><div class=highlight><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash>$ skopeo sync --src docker --dest docker docker.io/YOUR-ORG/REPO-NAME quay.io/YOUR-ORG

INFO<span style=color:#f92672>[</span>0000<span style=color:#f92672>]</span> Tag presence check              imagename<span style=color:#f92672>=</span>docker.io/org/repo tagged<span style=color:#f92672>=</span>false
INFO<span style=color:#f92672>[</span>0000<span style=color:#f92672>]</span> Getting tags                    image<span style=color:#f92672>=</span>docker.io/org/repo
INFO<span style=color:#f92672>[</span>0000<span style=color:#f92672>]</span> Copying image tag 1/2295        from<span style=color:#f92672>=</span><span style=color:#e6db74>&#34;docker://org/repo:r8842&#34;</span> to<span style=color:#f92672>=</span><span style=color:#e6db74>&#34;docker://quay.io/org/repo:r8842&#34;</span>
...
</code></pre></div><p>Skopeo will index all of the tags, and one by one copy the relevant blobs from DockerHub to Quay. You can refresh Quay to see this as it progresses.</p><p>And that&rsquo;s it! Once skopeo finishes, your tags will be safe over on quay. You should tell users to pull images from the new source, and make sure your CI system is set to push there instead (or at least schedule a cron job to sun <code>skopeo</code> again).</p><p>I hope this helped you in some way and that you enjoyed the read. Until next time, cya!</p></div><div class=pagination><div class=pagination__title><span class=pagination__title-h>Read other posts</span><hr></div><div class=pagination__buttons><span class="button next"><a href=/posts/2016-cloudflare-letsencrypt/><span class=button__text>Cloudflare with LetsEncrypt SSL Certificates + Apache's ProxyPass</span>
<span class=button__icon>→</span></a></span></div></div></div></div><footer class=footer><div class=footer__inner><a href=/ class=logo style=text-decoration:none><span class=logo__mark><svg xmlns="http://www.w3.org/2000/svg" class="greater-icon" viewBox="0 0 44 44"><path fill="none" d="M15 8l14.729 14.382L15 35.367"/></svg></span><span class=logo__text>CC's Sink</span>
<span class=logo__cursor></span></a><div class=copyright><span>© 2020 Powered by
<a href=https://gohugo.io target=_blank rel=noopener>Hugo</a></span>
<span>Theme created by
<a href=https://twitter.com/panr target=_blank rel=noopener>panr</a></span></div></div></footer><script src=/assets/main.js></script><script src=/assets/prism.js></script></div></body></html>